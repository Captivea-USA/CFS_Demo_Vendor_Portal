<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <record id="view_account_move_form" model="ir.ui.view">
            <field name="name">Account Move Approval</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_register_payment']" position="replace">
                    <field name='is_approved' invisible='1'/>
                    <button name="action_register_payment" id="account_invoice_payment_btn" type="object" class="oe_highlight" 
                            attrs="{'invisible': ['|', '|', '|', ('release_to_pay_manual','!=','yes'), ('state', '!=', 'posted'), ('payment_state', 'not in', ('not_paid', 'partial')), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"
                            context="{'dont_redirect_to_payments': True}" 
                            string="Register Payment" 
                            data-hotkey="g" 
                            groups="account.group_account_invoice"/>
                </xpath>
                <!--EOI 350-->
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button class="oe_stat_button" name="action_view_approvals" type="object" icon="fa-pencil-square-o" attrs="{'invisible': [('multi_approval_id_count', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="multi_approval_id_count"/>
                            </span>
                            <span class="o_stat_text">Approvals</span>
                        </div>
                    </button>
                    <script>
                        $( document ).ready(function() {
                            $('button[name="action_view_approvals"]').removeClass("o_invisible_modifier");
                        });
                    </script>
                </xpath>
                <xpath expr="//field[@name='ref']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
                <!--EOI 380-->
                <xpath expr="//field[@name='invoice_date']" position="attributes">
                    <attribute name='attrs'>{'required': [('move_type','!=','entry')], 'invisible': [('move_type','=','entry')] }</attribute>
                </xpath>
                <xpath expr="//form[1]/sheet[1]/group[1]/group[1]/field[@name='partner_bank_id']" position="after">
                    <field name = "acc_type" />
                </xpath>
                <!-- EOI 350 -->
                <xpath expr="//form[1]/sheet[1]/group[1]/group[2]/field[@name='date']" position="after">
                    <field name="linked_purchase_id"/>
                </xpath>
                <xpath expr="//page[@name='other_info']//field[@name='company_id']" position="before">
                    <field name="on_hold"/>
                </xpath>
                <xpath expr="//page[@name='other_info']//field[@name='fiscal_position_id']" position="attributes">
                    <attribute name="string">Default Tax Status</attribute>
                </xpath>
                <xpath expr="//field[@name='invoice_cash_rounding_id']" position="replace"/>
            </field>
        </record>

        <!--EOI 350-->
        <record id="view_account_move_enhanced" model="ir.ui.view">
            <field name="name">Account Move Tree Enhanced</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='activity_ids']" position="after">
                    <field name="company_id"/>
                </xpath>
                <xpath expr="//field[@name='amount_total_signed']" position="after">
                    <field name="invoice_payment_term_id" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='invoice_payment_term_id']" position="after">
                    <field name="terms_due_date" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='terms_due_date']" position="after">
                    <field name="terms_amount" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="after">
                    <field name="acc_type"/>
                </xpath>
                <xpath expr="//field[@name='acc_type']" position="after">
                    <field name="is_approved"/>
                </xpath>
                <xpath expr="//field[@name='is_approved']" position="after">
                    <field name="bank_info_check" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='bank_info_check']" position="after">
                    <field name="release_to_pay_manual" widget="badge" optional="show" decoration-danger="release_to_pay_manual == 'no'" decoration-warning="release_to_pay_manual == 'exception'" decoration-success="release_to_pay_manual =='yes'"/>
                </xpath>
                <xpath expr="//field[@name='to_check']" position="replace">
                    <field name='to_check' invisible='1'/>
                </xpath>
                <xpath expr="//field[@name='date']" position="replace">
                    <field name='date' invisible='1'/>
                </xpath>
                <xpath expr="//field[@name='amount_total_in_currency_signed']" position="replace">
                    <field name='amount_total_in_currency_signed' invisible='1'/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="replace">
                    <field name='currency_id' invisible='1'/>
                </xpath>
            </field>
        </record>

        <!-- EOI 338 -->
        <record id="view_account_move_multi_approval_form" model="ir.ui.view">
            <field name="name">Account Move Multi Approval View</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/header" position="inside">
                    <field name="x_need_approval" invisible="1"/>
                    <field name="x_review_result" invisible="1"/>
                    <field name="is_approved" invisible="1"/>
                    <field name="x_has_request_approval" invisible="1"/>
                    <field name="multi_approval_id_count" invisible="1"/>
                    <field name="check_product_type" invisible="1"/>
                    <button name="action_request" attrs="{'invisible': [  '|', '|', ['check_product_type','=','receivable'],['state','!=','posted'], ['multi_approval_id_count','!=',0]]}" type="object" class="oe_highlight" approval_btn="1" string="Request Approval"/>
                    <button name="%(multi_level_approval_configuration.action_open_request)d" type="action" string="View Approval" groups="multi_level_approval.group_approval_user" attrs="{'invisible': [('x_has_request_approval', '=', False)]}" approval_btn="1"/>
                    <button name="%(multi_level_approval_configuration.rework_approval_action)d" type="action" string="Rework" groups="multi_level_approval.group_approval_user" attrs="{'invisible': [('x_review_result', '!=', 'refused')]}" approval_btn="1"/>
                </xpath>
                <xpath expr="//form/sheet" position="before">
                    <div>
                        <div attrs="{'invisible': ['|', ('x_need_approval', '=', False), ('x_review_result', '!=', False)]}" class="alert alert-danger" style="margin-bottom:0px;" role="alert">This Bill has not been approved.</div>
                        <div attrs="{'invisible': ['|', ('x_need_approval', '=', False), ('x_review_result', '!=', 'reapprove')]}" class="alert alert-danger" style="margin-bottom:0px;" role="alert">This Bill needs another approval.</div>
                        <div attrs="{'invisible': ['|', ('x_need_approval', '=', False), ('x_review_result', '!=', 'refused')]}" class="alert alert-danger" style="margin-bottom:0px;" role="alert">This Bill has been refused.</div>
                    </div>
                </xpath>
            </field>
        </record>

        <!-- EOI 350 - Reproduce Accounting -->
        <record id="purchase_to_bill_list_view" model="ir.ui.view">
            <field name="name">purchase.to.bill.list.view</field>
            <field name="type">tree</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
            <field name="arch" type="xml">
                <data>
                    <xpath expr="//field[@name='name']" position="attributes">
                        <attribute name="string">PO Number</attribute>
                    </xpath>
                    <xpath expr="//field[@name='date_approve']" position="attributes">
                        <attribute name="string">Approved On</attribute>
                    </xpath>
                    <xpath expr="//field[@name='date_planned']" position="attributes">
                        <attribute name="string">Need Date</attribute>
                        <attribute name="widget">date</attribute>
                    </xpath>
                    <xpath expr="//field[@name='user_id']" position="attributes">
                        <attribute name="string">Created By</attribute>
                    </xpath>
                    <xpath expr="//field[@name='user_id']" position="after">
                        <field name="cfs_released_by" optional="show"/>
                    </xpath>
                    <xpath expr="//field[@name='state']" position="attributes">
                        <attribute name="invisible">0</attribute>
                        <attribute name="widget">badge</attribute>
                    </xpath>
                    <xpath expr="//field[@name='state']" position="after">
                        <field name="cfs_is_transfer_return" optional="show"/>
                    </xpath>
                </data>
            </field>
        </record>

        <record id="account_purchase_to_bill" model="ir.actions.act_window">
            <field name="name">PO's to Bill</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="cap_approvals.purchase_to_bill_list_view"/>
            <field name="domain">[('invoice_status','=','to invoice')]</field>
            <field name="target">current</field>
            <field name="help" type="html">
                <p>PO's to Bill</p>
            </field>
        </record>

        <menuitem 
            id="menu_purchase_to_bill" 
            name="PO's to Bill" 
            action="cap_approvals.account_purchase_to_bill" 
            parent="account.menu_finance_payables" 
            sequence="0" />

    </data>
</odoo>
